<%- include('partials/header', { title, q, category, categories, seller }) %>
<div class="container layout">
  <aside class="filter">
    <div class="section"><h4>Category</h4><div class="body">
      <% categories.forEach(c => { %>
        <label>
          <input type="checkbox" <%= category===c ? 'checked' : '' %> onclick="window.location='/products?category=<%= encodeURIComponent(c) %>'">
          <%= c %>
        </label>
      <% }) %>
    </div></div>
  </aside>

  <section>
    <div class="list-toolbar">
      <div class="count"><%= total %> items<% if (category) { %> in <strong><%= category %></strong><% } %></div>
      <div style="flex:1"></div>
      <a class="btn ghost" href="/products">Clear</a>
    </div>

    <div class="product-list grid" style="gap:12px">
      <% if (!products.length) { %>
        <div class="muted">No products found.</div>
      <% } %>
      <% products.forEach(p => { %>
        <div class="card-item">
          <img src="<%= p.image %>" alt="">
          <div>
            <div class="title"><%= p.name %></div>
            <div class="price">$<%= p.price.toFixed(2) %></div>
            <div class="meta"><%= p.category %></div>
            <a class="btn ghost" href="/products/<%= p._id %>">View details</a>
          </div>
          <div class="actions"><a class="btn">â™¡</a></div>
        </div>
      <% }) %>
    </div>

    <div class="mt-20 pager">
      <% for (let i=1; i<=totalPages; i++) { %>
        <% if (i === page) { %>
          <span class="current"><%= i %></span>
        <% } else { %>
          <a href="?page=<%= i %><%= q ? '&q='+encodeURIComponent(q) : '' %><%= category ? '&category='+encodeURIComponent(category) : '' %>"><%= i %></a>
        <% } %>
      <% } %>
    </div>
  </section>
</div>
<%- include('partials/footer') %>